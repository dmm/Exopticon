-- Your SQL goes here
CREATE TABLE notifiers (
       id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
       name VARCHAR NOT NULL,
       hostname VARCHAR NOT NULL,
       port INTEGER NOT NULL CHECK (port >= 0 AND port < 65536),
       username VARCHAR,
       password VARCHAR,
       inserted_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,
       updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE alert_rules (
       id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
       name VARCHAR NOT NULL,
       analysis_instance_id INTEGER NOT NULL REFERENCES analysis_instances,
       tag VARCHAR NOT NULL,
       details VARCHAR NOT NULL,
       min_score SMALLINT NOT NULL,
       min_cluster_size SMALLINT NOT NULL,
       cool_down_time BIGINT NOT NULL,
       notifier_id INTEGER NOT NULL REFERENCES notifiers,
       inserted_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,
       updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE alerts (
       id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
       alert_rule_id INTEGER NOT NULL REFERENCES alert_rules,
       time TIMESTAMP WITH TIME ZONE NOT NULL,
       inserted_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP
);

